name: Inspect PAT Secret

on:
  workflow_dispatch: # Permite ejecución manual

jobs:
  inspect-secret:
    runs-on: ubuntu-latest
    steps:
      - name: Inspect the PAT secret to verify its format
        run: |
          echo "Inspeccionando el secreto PAT..."
          SECRET_VALUE="${{ secrets.PAT }}"
          
          if [ -z "$SECRET_VALUE" ]; then
            echo "::error:: ¡El secreto PAT está completamente vacío! Por favor, verifica que el secreto existe y tiene un valor."
            exit 1
          fi
          
          LENGTH=${#SECRET_VALUE}
          echo "Longitud del secreto: $LENGTH caracteres."
          
          # Un Token (Classic) siempre tiene 40 caracteres.
          if [ "$LENGTH" -ne 40 ]; then
            echo "::error:: La longitud NO es 40. Un Token (Classic) válido siempre tiene 40 caracteres. Esto indica un error al copiar/pegar o un tipo de token incorrecto."
          else
            echo "✅ La longitud es la correcta (40 caracteres)."
          fi

          PREFIX=$(echo "$SECRET_VALUE" | cut -c 1-4)
          
          # Un Token (Classic) siempre empieza con 'ghp_'.
          if [ "$PREFIX" = "ghp_" ]; then
            echo "✅ El prefijo del secreto es 'ghp_', que corresponde a un Token (Classic)."
          else
            echo "::error:: ¡El prefijo NO es 'ghp_'! El token que estás usando NO es un Token (Classic). Probablemente es un 'Fine-grained token'. Este es el origen del problema."
            exit 1
          fi

          echo "Si ambos puntos anteriores son correctos, el token tiene el formato correcto."
