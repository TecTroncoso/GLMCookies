name: Debug GH Authentication

on:
  workflow_dispatch: # Permite ejecución manual

jobs:
  auth-test:
    runs-on: ubuntu-latest
    steps:
      - name: Test GH CLI Authentication
        env:
          GH_TOKEN: ${{ secrets.PAT }}
        run: |
          # El comando 'set -x' mostrará cada comando antes de ejecutarlo
          set -x

          echo "Paso 1: Instalando gh CLI"
          sudo apt-get update > /dev/null && sudo apt-get install -y gh > /dev/null
          
          echo "Paso 2: Verificando la versión de gh"
          gh --version

          echo "Paso 3: Intentando autenticar. Si falla aquí, el token es el problema."
          echo "$GH_TOKEN" | gh auth login --with-token
          
          echo "Paso 4: La autenticación fue exitosa. Verificando estado."
          gh auth status

          echo "¡Éxito! El token y el secreto son correctos."
